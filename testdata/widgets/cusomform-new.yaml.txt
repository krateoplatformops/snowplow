---
kind: ConfigMap
apiVersion: v1
metadata:
  name: fireworksapp
  namespace: demo-system
data:
  onSubmitName: submit
  onSubmitVerb: POST
  title: Brian Ingerson
  description: The co-inventor of YAML
---
kind: RESTAction
apiVersion: templates.krateo.io/v1
metadata:
  name: get-fireworksapps-crd
  namespace: demo-system
spec:
  api:
  - name: getCRD
    path: "/apis/apiextensions.k8s.io/v1/customresourcedefinitions/fireworksapps.composition.krateo.io"
    verb: GET
    headers:
    - 'Accept: application/json'
  - name: getNamespaces
    path: "/api/v1/namespaces"
    verb: GET
    headers:
    - 'Accept: application/json'
---
apiVersion: templates.krateo.io/v1
kind: Widget
metadata:
  name: fireworksapp
  namespace: demo-system
spec:
  type: customform
  propsRef:
    name: fireworksapp
    namespace: demo-system
  apiRef:
    name: get-fireworksapps-crd
    namespace: demo-system
  actions:
  - template:
      id: submit
      name: demo
      namespace: demo-system
      apiVersion: composition.krateo.io/v1-1-3
      resource: fireworksapps
      verb: PUT
      payloadToOverride:
      - name: metadata.name
        value: ${ git.toRepo.name }
      - name: metadata.namespace
        value: ${ git.toRepo.name + "-ns" }
  data:
    selector: ${ .getCRD | .spec.versions[] | select(.name == "v1-1-3") | .schema.openAPIV3Schema.properties.spec.properties }
    hide: 
    - argocd
    - git.properties.fromRepo
    - git.required[] | select(. == "fromRepo")
    override:
    - name: git.properties.toRepo.properties.deletionPolicy.default
      value: ${ [.getNamespaces | .items[].metadata.name][1] | tojson }
    - name: git.properties.toRepo.properties.deletionPolicy.enum
      value: ${ [.getNamespaces | .items[].metadata.name] }
